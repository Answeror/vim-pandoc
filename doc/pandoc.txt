*pandoc.txt* 	For Vim version 7.3 	Last change: 2011 Aug 28

[This document is formatted as a markdown file _and_ as a vim helpfile.
If viewing from within vim, set ft=help to view it as a helpfile, and
set ft=pandoc to view it as a (pandoc) markdown file.]

Vim Plugin for *pandoc*
=======================

This is a bundle for writing and editing documents in [pandoc][]'s
[extended markdown][]. It provides

-   some settings to make vim a pleasant |pandoc-writing-environment|,
-   |pandoc-syntax-highlighting|, with support for pandoc's extended
     markdown,
-   |pandoc-snippets| for use with [snipMate][],
-   |pandoc-section-folding|,
-   |pandoc-citation-completion|,
-   some simple |pandoc-conversion-functions| and |pandoc-tidying-functions|,
-   a few |pandoc-localleader-mappings|

*pandoc-writing-enviroment*
===========================

The bundle sets the following options, in an effort to provide a
pleasant writing environment:

    setlocal linebreak
    setlocal breakat-=*

|linebreak| tells vim to break lines at word boundaries. The |breakat|
setting is to account for asterisks used for emphasis.

    nnoremap <buffer> j gj
    nnoremap <buffer> k gk
    vnoremap <buffer> j gj
    vnoremap <buffer> k gk

These mappings allow use of j and k to move up and down in the middle of
a soft-wrapped line.

    setlocal display=lastline

If you are using soft-wrapping, this will tell vim to go ahead and
show part of a long line that runs off the bottom of the screen.

    setlocal nojoinspaces

|nojoinspaces| allows you to use CTRL-J to join the next line with the
current line without adding extra unwanted spaces.

    setlocal commentstring=<!--%s-->
    setlocal comments=s:<!--,m:\ \ \ \ ,e:-->

tells vim to use HTML style comments in your markdown files. For more, see
|comments| and |commentstring|.

*pandoc-hard-wrapping*
----------------------

By default, the bundle assumes that you will be using soft wrapping, and
applies

    setlocal formatoptions=1

If you prefer hard wrapping, set g:pandoc_use_hard_wraps, i.e., put
something like

    let g:pandoc_use_hard_wraps = 1

in your vimrc. When that is set, the bundle instead sets

    setlocal formatoptions=qct

If you also want autoformatting, set g:pandoc_auto_format:

    let g:pandoc_auto_format = 1

in your vimrc. For more information, see |formatoptions|. (Note that
autoformatting can slow things down.)

*pandoc-syntax-highlighting*
============================

The syntax highlighting should be fairly accurate and complete. By
default, the bundle tries to be smart, and only highlight implicit links
if there is a matching link definition. This can be expensive on large
files and slow things down. To disable it, set
g:pandoc_no_empty_implicits:

    let g:pandoc_no_empty_implicits = 1

*pandoc-snippets*
=================

If you use |snipMate|, take a look at snippets/pandoc.snippets to see what
is available. One nice example: at the start of a document, type
`%%<TAB>` to generate a title block, with the filename as title, the
value of `g:snips-author` as author, and the current date.

*pandoc-section-folding*
========================

The bundle tells vim to fold documents by section. If you haven't used
folding before, see |fold-commands|. When used with [FoldList][] this
also provides a handy navigable outline view of your document.

But folding can slow things down. To disable it, set
g:pandoc_no_folding:

    let g:pandoc_no_folding = 1

*pandoc-citation-completion*
============================

If you have a bibtex file (or a symlink to a bibtex file) named
'default.bib' in one of these folders,

    ~/.pandoc
    ~/Library/texmf/bibtex/bib
    ~/texmf/bibtex/bib

then the plugin will automatically use that file for citation
completion. Or, set g:pandoc_bibfile:

    let g:pandoc_bibfile = '/the/path/to/your/bibtex/file.bib'

to use your preferred file.

To use completion, start typing a citekey, e.g.,

    @geac

and then, while still in insert mode, hit CTRL-X CTRL-O (vim's shortcut
for |omni-completion|), and you'll get a popup window with a list of
matching keys, e.g.,

    @geach1970
    @geach1972

Regular expressions work too:

    @le.*90

should suggest both '@leftow1990' and '@lewis1990', assuming those are
both keys in your bibliography.

The plugin also provides support for using this with [SuperTab][]. You
will want something like this in your vimrc: 

    let g:SuperTabDefaultCompletionType = "context"

Then you can just hit TAB in the middle of typing a citation
to complete the citation.

> **KNOWN BUGS**:
>
> -   SuperTab completion of citations only works after you use ctrl-x
>     ctrl-o completion once within a given file.
> -   Regular expressions don't work when using SuperTab.

> **TODO**: pandoc.vim should be smarter about finding bibliography
> files. This includes:
>
> -   borrowing settings from latex plugins, if present
> -   finding the local texmf tree programatically
> -   using (all?) bibtex files found in any of the search paths
> -   including the directory that the file is in among the search paths
> -   better support for other bibliography database formats

*pandoc-citation-dictionary*
----------------------------

We are leaving this in for now, but now that proper completion is
working, we'll probably get rid of it. If you create a text file,
`
    ~/.pandoc/citationkeys.dict

that contains a list of citation keys, one per line, like so

    @adams1967a
    @adams1971
    @adams1972a
    @adams1974
    @adams1977
    @adams1986a

these citekeys are added to vim's |dictionary|, allowing for
completion by typing part of a citekey, e.g.,

    @adams19

and then hitting CTRL-X CTRL-K (or via SuperTab).

*pandoc-conversion-functions*
=============================

Pandoc can be used to perform lots of different conversions. We've
made no attempt to provide functions that cover all these possibilities,
since it is easy to do something like

    :!markdown2pdf %

If there is a particular conversion that you do all the time with a
particular set of options, you might want to define a leader mapping
in your vimrc.

*PandocRegisterExecutor*
------------------------

Better yet, you can define a command and a mapping using the
PandocRegisterExecutor command. It tells vim-pandoc to register a local command
and a local mapping for a certain set of pandoc parameters. It can also specify
whether the resulting file should be opened or not. We call this an executor.
The syntax of `PandocRegisterExecutor` is

    :PandocRegisterExecutor NAME MAP OPEN COMMAND

where NAME is the name of the Command, MAP is the mapping for it, OPEN is a
flag specifying if the resulting file should be opened using the default
application (on linux, this depends on xdg-open being available), and COMMAND
is a description of the command to create the document. For example:

    :PandocRegisterExecutor PdcPdf <Leader>pdf 1 markdown2pdf

should register a PdcPdf command that runs markdown2pdf on the current file and
opens the resulting pdf afterwards, and a mapping to do the same.

Executors are registered before opening a file.

Executors depend on the `pandoc_execute` function, which can be called like
this:

    :py pandoc_execute(COMMAND, OPEN)

COMMAND can include vim variables, like `g:pandoc_bibfile`. Those will be
evaluated before executing the command, so the user can define executors that
can access those variables. For example:

    :PandocRegisterExecutor PdcPdfB <Leader>pdfb 1 markdown2pdf --bibliography g:pandoc_bibfile

Default executors
-----------------

By default, vim-pandoc provides some handy executors:

* *PandocPdfOpen* (`<localleader>pdf`), which runs markdown2pdf.
* *PandocHtmlOpen* (`<localleader>html`), which creates a standalone html.
* *PandocOdtOpen* (`<localleader>odt`), which creates an ODT file.

and

* *PandocPdfBibOpen* (`<localleader>pdfb`), which runs markdown2pdf using the
  value of `g:pandoc_bibfile` as the bibliography.
* *PandocOdtBibOpen* (`<localleader>odtb`), which creates an ODT file using
  `g:pandoc_bibfile` as the bibliography.

For the mappings to work, you must have |maplocalleader| defined in your vimrc,
e.g.,

    let maplocalleader = ","

Then, for example, you can type something like `,pdf` and a PDF version of your
current buffer will be displayed.

*pandoc-tidying-functions*
==========================

The plugin defines two functions designed for tidying up your markdown:
*MarkdownTidy* and *MarkdownTidyWrap*. Running MarkdownTidyWrap is
equivalent to

    :%!pandoc -t markdown -s

Note that this can have some unexpected effects: it will replace all of
your reference link ids with implicit reference links; it will replace
all of your footnote ids with numbers; it will transform any setext
style headers into atx style headers; it will process any latex macros
you may have defined and delete the macro definitions; if your document
lacks a title block, it will add one.

The plugin also sets

    setlocal equalprg=pandoc\ -t\ markdown\ --reference-links

In practice, this value for |equalprg| makes it easy to hard-wrap
paragraphs nicely, using vim's `=` command. If you prefer soft wrapping,
you might want to change this to

    setlocal equalprg=pandoc\ -t\ markdown\ --reference-links\ --no-wrap

Note that this will *remove* any title block, as well as processing any
custom latex macros. So you might not want to do something like `ggvG=`.

*pandoc-localleader-mappings*
=============================

If |maplocalleader| is defined, vim-pandoc defines a handful of
localleader mappings in addition to |PandocHTMLOpen| et al.

First,

    <localleader>www

when invoked from within a url, like http://example.com, will open that
url in your default browser.

Second, there are two commands for jumping back and forth between a
reference-style link and its definition:

    <localleader>gr
    <localleader>br

`gr` jumps from the link to its definition; `br` jumps back. If you want
to try this out on this document, and you are reading this within vim,
first

    :set maplocalleader = ","
    :set ft=pandoc

then move your cursor [somewhere in here][], and type `,gr`. Wasn't that
fun?[^note] Now you probably want to go ahead and

    :set ft=help

to get back to viewing this as a help file.

[somewhere in here]: http://example.com "Now type `,br` to jump back."
[^note]: Also supports footnotes. Type `,br` to jump back.

Finally, there is

    <localleader>nr

`,nr` creates a new reference definition from within a reference link.
So if you have typed something like

    This is a [link][id]. And here is another sentence.

and type `,nr` from somewhere within `[link][id]`, you will get

    This is a [link][id]. And here is another sentence.

    [id]: <your cursor here>

Of course, when you are done filling in the link, you can hit `,br` to
jump back to where you were.

Maintainers
===========

+    [Felipe Morales](https://github.com/fmoralesc/)
+    [David Sanson](https://github.com/dsanson/) 

Thanks also to [Wei Dai][] for bug fixes and improvements.

Borrowings
==========

The syntax file derives from Jeremy Schultz's [pdc.vim][] as
githubbed by [wunki][].

The snippets file is a slight extension (and contraction) of the
markdown.snippets file that is part of many of the [vim-markdown
repositories on github][].

Autocompletion was implemented by hacking away at [LaTeX Box][]'s
implementation of bibtex citation completion, even if the results don't
look much like the original.

Known Issues
============

1.  Filetype detection does not play well with [markdown-vim][].

2.  Filetype detection is aggressive: we assume that if you use this
    plugin, then you want to use pandoc for you markdown needs. So we
    match the following extensions: .markdown, .md, .mkd, .pd, .pdk,
    .pandoc, and .text.

* * * *

  [pandoc]: http://johnmacfarlane.net/pandoc/
  [extended markdown]: http://johnmacfarlane.net/pandoc/README.html#pandocs-markdown
  [snipMate]: http://www.vim.org/scripts/script.php?script_id=2540
  [Wei Dai]: https://github.com/clvv
  [pdc.vim]: http://www.vim.org/scripts/script.php?script_id=2389
  [wunki]: https://github.com/wunki/vim-pandoc
  [vim-markdown repositories on github]: https://github.com/hallison/vim-markdown
  [LaTeX Box]: http://www.vim.org/scripts/script.php?script_id=3109
  [SuperTab]: http://www.vim.org/scripts/script.php?script_id=1643
  [FoldList]: http://www.vim.org/scripts/script.php?script_id=500
  [markdown-vim]: http://plasticboy.com/markdown-vim-mode/


 vim:tw=78:ts=8:ft=help:norl: 

